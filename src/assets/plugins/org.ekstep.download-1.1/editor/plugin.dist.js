org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.download","ver":"1.1","author":"Gourav More","title":"download","description":"","publishedDate":"","editor":{"main":"editor/plugin.js","menu":[]}},org.ekstep.contenteditor.basePlugin.extend({type:"download",initialize:function(){ecEditor.addEventListener("download:content",this.downloadContent,this);var e=ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/popup.html");ecEditor.getService("popup").loadNgModules(e)},downloadContent:function(){var t=this;t.isSending="active",t.isLoading=!1,t.isSuccess=!1,t.isDownloading=!1,t.getDownloadUrl(function(e){t.downloadFile(e)}),t.generateTelemetry({type:"click",subtype:"download",target:"downloadContent",targetid:ecEditor.getContext("contentId")})},downloadFile:function(e){var e=JSON.stringify(e,null,2),e=new Blob([e],{type:"application/json"}),e=window.URL.createObjectURL(e),t=document.createElement("a");t.href=e,t.download="data.json",t.click(),window.URL.revokeObjectURL(e),t.remove()},getDownloadUrl:function(e){e(ecEditor.getService("content").getECML())},sendEmail:function(t,e){ecEditor.jQuery.ajax({url:ecEditor.getConfig("baseURL")+"/index.php?option=com_api&app=ekcontent&resource=download&format=raw",headers:{"x-auth":"session"},type:"POST",data:{downloadUrl:e,name:ecEditor.getService("content").getContentMeta(ecEditor.getContext("contentId")).name},success:function(e){t.isLoading=!1,t.status="OK"==e.responseCode,t.getMessage=e.result,ecEditor.jQuery(".ct_download_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope())},error:function(){t.isLoading=!1,t.status=!1,t.getMessage="Unable to send email, please try again later",ecEditor.jQuery(".ct_download_msg").transition("drop"),ecEditor.ngSafeApply(ecEditor.getAngularScope())}})},generateTelemetry:function(e){e&&ecEditor.getService("telemetry").interact({type:e.type,subtype:e.subtype,id:e.target,pageid:org.ekstep.contenteditor.api.getCurrentStage().id||"",target:{id:e.targetid||"",type:"plugin",ver:""},plugin:{id:this.manifest.id,ver:this.manifest.ver,category:"core"},ver:"3.0"})}}))