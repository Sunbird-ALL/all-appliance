org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.stageconfig","ver":"1.0","author":"Sunil","title":"Stage Config","description":"","publishedDate":"","editor":{"main":"editor/plugin.js"}},org.ekstep.contenteditor.basePlugin.extend({type:"org.ekstep.stageconfig",stageAudios:{},scope:ecEditor.getAngularScope(),initialize:function(){ecEditor.addEventListener(this.manifest.id+":addcomponent",this.register,this),ecEditor.addEventListener("stage:render:complete",this.stageRender,this),ecEditor.addEventListener(this.manifest.id+":remove",this.removeAudio,this)},register:function(t,e){this.stageAudios[e.stageId]||(this.stageAudios[e.stageId]=[]),this.stageAudios[e.stageId].push(e),this.showComponents(e.stageId)},getStageIndex:function(e){return ecEditor._.findIndex(this.stageConfig,function(t){return e.stageId===t.stageId})},addComponents:function(e){var s=this,t=ecEditor.getStagePluginInstances(e,["org.ekstep.audio"]);t.length&&(this.stageAudios[e]=this.stageAudios[e]||[]),_.each(t,function(t){s.stageAudios[e].push(t.audioData)})},stageRender:function(t,e){this.showComponents(e.stageId)},showComponents:function(t){this.stageAudios[t]||this.addComponents(t);var e=this,e=(this.hideStageComponents(t),setTimeout(function(){e.showStageComponents(t)},500),this);ecEditor.ngSafeApply(e.scope,function(){e.scope.currentStage=ecEditor.getCurrentStage()})},showStageComponents:function(t){var e=this,s=[];ecEditor._.forEach(this.stageAudios[t],function(t){var e;t&&(e=ecEditor.getPluginInstance(t.id),t.autoplay=e.config.autoplay,s.push(t))}),ecEditor.ngSafeApply(e.scope,function(){e.scope.stageAttachments.audio={},e.scope.stageAttachments.audio.items=s,e.scope.stageAttachments.audio.show=!0})},hideStageComponents:function(t){var e=this;ecEditor.ngSafeApply(e.scope,function(){e.scope.stageAttachments.audio={},e.scope.stageAttachments.audio.items=[],e.scope.stageAttachments.audio.show=!1})},removeAudio:function(t,e){this.stageAudios[e.stageId]=ecEditor._.reject(this.stageAudios[e.stageId],{id:e.id}),this.showComponents(e.stageId)}}))