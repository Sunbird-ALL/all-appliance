org.ekstep.pluginframework.pluginManager.registerPlugin({"id":"org.ekstep.questionset","ver":"1.0","author":"Manoj Chandrashekar","title":"Question Set Plugin","description":"Plugin to add question set to content","publishedDate":"","editor":{"main":"editor/plugin.js","dependencies":[{"type":"plugin","plugin":"org.ekstep.question","ver":"1.0"},{"type":"plugin","plugin":"org.ekstep.questionunit","ver":"1.2"},{"type":"plugin","plugin":"org.ekstep.questionbank","ver":"1.0"},{"type":"plugin","plugin":"org.ekstep.questionset.quiz","ver":"1.0"},{"type":"plugin","plugin":"org.ekstep.questionset.preview","ver":"1.1"},{"type":"css","src":"editor/style/style.css"}],"menu":[{"id":"question-set","category":"main","type":"icon","toolTip":"Add Question Set","title":"Question Set","iconClass":"icon-questions icon","onclick":{"id":"org.ekstep.questionset:showPopup"}}],"configManifest":[{"PropertyName":"btn_edit","title":"Edit question set","description":"Choose a question from the question bank","dataType":"button","valueType":"text","required":true,"onclick":{"id":"org.ekstep.questionset:showPopup","type":"questionset"}},{"propertyName":"title","title":"Question Set Title","description":"Question Set Title","dataType":"input","valueType":"text","required":true},{"propertyName":"shuffle_questions","title":"Shuffle Questions","description":"Shuffle the Questions","dataType":"boolean","required":true},{"propertyName":"show_feedback","title":"Show Immediate Feedback","description":"Show the feedback popup","dataType":"boolean","required":true},{"propertyName":"total_items","title":"Display","description":"Total questions to display","dataType":"input","valueType":"number","required":true,"minimumValue":"0"},{"propertyName":"max_score","title":"Total Marks","description":"Maximum score","dataType":"input","valueType":"number","required":true,"minimumValue":"1","maximumValue":"99"}]},"renderer":{"main":"renderer/plugin.js","dependencies":[{"type":"js","src":"renderer/utils/telemetry_logger.js"},{"type":"js","src":"renderer/utils/html_audio_plugin.js"},{"type":"js","src":"renderer/utils/qs_feedback_popup.js"}]},"dependencies":[{"plugin":"org.ekstep.questionset.quiz","ver":"1.0","type":"plugin","scope":"renderer"},{"type":"plugin","plugin":"org.ekstep.iterator","ver":"1.0","scope":"renderer"}]},org.ekstep.questionset={},org.ekstep.questionset.EditorPlugin=org.ekstep.contenteditor.basePlugin.extend({type:"org.ekstep.questionset",_plugins:[],_questions:[],_questionPlugin:"org.ekstep.question",_constants:{v1PluginId:"org.ekstep.questionset.quiz",templateId:"horizontalMCQ",questionUnitId:"org.ekstep.questionunit"},_dependencyPlugin:"org.ekstep.questionbank",katexTemplate:{manifest:{media:[{id:"org.ekstep.mathfunction_min_js",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/katex.min.js"},{id:"org.ekstep.mathfunction_min_css",plugin:"org.ekstep.mathfunction",type:"css",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/katex.min.css"},{id:"org.ekstep.mathfunction_font_mainbold",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_main-bold.ttf"},{id:"org.ekstep.mathfunction_font_bolditalic",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_main-bolditalic.ttf"},{id:"org.ekstep.mathfunction_font_mainitalic",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_main-italic.ttf"},{id:"org.ekstep.mathfunction_font_mainregular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_main-regular.ttf"},{id:"org.ekstep.mathfunction_font_bolditalic",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_math-bolditalic.ttf"},{id:"org.ekstep.mathfunction_font_mathitalic",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_math-italic.ttf"},{id:"org.ekstep.mathfunction_font_mathregular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_math-regular.ttf"},{id:"org.ekstep.mathfunction_font_size1regular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_size1-regular.ttf"},{id:"org.ekstep.mathfunction_font_size2regular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_size2-regular.ttf"},{id:"org.ekstep.mathfunction_font_size3regular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_size3-regular.ttf"},{id:"org.ekstep.mathfunction_font_size4regular",plugin:"org.ekstep.mathfunction",type:"js",src:"/plugins/org.ekstep.mathfunction-1.0/renderer/libs/katex/fonts/katex_size4-regular.ttf"}]},pluginManifest:{id:"org.ekstep.mathfunction",type:"plugin",ver:"1.0",depends:""}},initialize:function(){var t=this,e=(new Date).getTime(),e=(ecEditor.loadAndInitPlugin(t._dependencyPlugin,"1.0",e),ecEditor.addEventListener(this.manifest.id+":getPlugins",this.getplugins,this),ecEditor.addEventListener(t.manifest.id+":showPopup",t.openQuestionBank,t),ecEditor.addEventListener(t.manifest.id+":addQS",t.addQS,t),[{identifier:"org.ekstep.questionunit.mtf",appIcon:ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/mtf_app_icon.jpg"),semanticVersion:"1.2",contentType:"Plugin",objectType:"Content"},{identifier:"org.ekstep.questionunit.mcq",appIcon:ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/mcq_app_icon.jpg"),semanticVersion:"1.3",contentType:"Plugin",objectType:"Content"},{identifier:"org.ekstep.questionunit.ftb",appIcon:ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/ftb_app_icon.jpg"),semanticVersion:"1.1",contentType:"Plugin",objectType:"Content"},{identifier:"org.ekstep.questionunit.reorder",appIcon:ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/reorder_app_icon.jpg"),semanticVersion:"1.1",contentType:"Plugin",objectType:"Content"},{identifier:"org.ekstep.questionunit.sequence",appIcon:ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/sequence_app_icon.jpg"),semanticVersion:"1.1",contentType:"Plugin",objectType:"Content"}]);t.pluginsRespHandler(e)},checkContentType:function(t){var e=ecEditor.getService(ServiceConstants.CONTENT_SERVICE).getContentMeta(ecEditor.getContext("contentId"));return e&&(e=e.contentType,"selfassess"===_.toLower(e))&&(t.manifest.editor.configManifest=_.remove(t.manifest.editor.configManifest,function(t){return"Display"!=t.title}),t.config.show_feedback=!1),t},newInstance:function(){var i=this,i=this.checkContentType(i),n=(delete this.configManifest,i.config.btn_edit="Edit",this.parent),s=(this.parent=void 0,this.attributes.x||(this.attributes.x=10,this.attributes.y=3,this.attributes.w=78,this.attributes.h=94,this.percentToPixel(this.attributes)),this.convertToFabric(this.attributes)),t=(delete s.width,delete s.height,i._questions=i.data||[],_.isArray(this._questions)&&this._questions.forEach(function(t){var e;1==t.version?(_.has(t,"media")&&t.media.forEach(function(t){i.addMedia(t)}),_.has(t,"mediamanifest")&&_.isArray(t.mediamanifest.media)&&t.mediamanifest.media.forEach(function(t){i.addMedia(t)})):((e=JSON.parse(t.body)).data.config.max_score=t.max_score,t.body=JSON.stringify(e),t=e.data,_.isEmpty(t.media)&&_.has(e,"media")&&t.media.forEach(function(t){t.src=org.ekstep.contenteditor.mediaManager.getMediaOriginURL(t.src),i.addMedia(t)}))}),ecEditor.resolvePluginResource(this.manifest.id,this.manifest.ver,"editor/assets/quizimage.png"));i.addMedia({id:"QuizImage",src:t,assetId:"QuizImage",type:"image",preload:!0}),fabric.Image.fromURL(t,function(t){var e=i.config.total_items+"/"+i.data.length,e=i.getPropsForEditor(i.config.title,e,i.config.max_score);i.editorObj=new fabric.Group([t,e]),i.parent=n,i.editorObj.scaleToWidth(s.w),i.postInit()},s)},getPropsForEditor:function(t,e,i){return t=new fabric.Text(t.toUpperCase(),{fontSize:15,fill:"black",textAlign:"center",top:33,left:105}),e=new fabric.Text(e+"  Questions,",{fontSize:12,fill:"black",top:50,left:105}),i=new fabric.Text(i+" Marks",{fontSize:12,fill:"black",top:50,left:190}),new fabric.Group([t,e,i])},addQS:function(t,e){var i=[],n=(_.isArray(e.data.data)&&e.data.data.forEach(function(t){i.push(t)}),{});n.config={__cdata:JSON.stringify(e.data.config)},n.data=i,ecEditor._.isUndefined(e.callback)||ecEditor.dispatchEvent("delete:invoke"),ecEditor.dispatchEvent(this.manifest.id+":create",n)},createEcmlStructureV1:function(t){var e={},i={questionnaire:{},template:{}},n=Object.assign({},t);return delete n.template,delete n.mediamanifest,n.template=t.template[0].id,e[t.identifier]=[n],i.questionnaire.items=e,i.questionnaire.item_sets=[{count:this.config.total_items,id:t.identifier}],i.questionnaire=ecEditor._.assign(i.questionnaire,this.config),i.template=ecEditor._.assign(t.template),JSON.stringify(i)},toECML:function(){var n=this,s=this._super();return s[n._questionPlugin]=[],_.isArray(n.data)&&n.data.forEach(function(t){var e={};if(1==t.version)e={id:_.isUndefined(t.identifier)?UUID():t.identifier,type:t.type,pluginId:n._constants.v1PluginId,pluginVer:1===t.version?"1.0":t.version.toString(),templateId:n._constants.templateId,data:{__cdata:n.createEcmlStructureV1(t)},config:{__cdata:JSON.stringify({type:"items",var:"item"})}},ecEditor._.forEach(t.media,function(t){ecEditor._.isEmpty(t)||n.addMedia(t)}),ecEditor.instantiatePlugin(n._constants.v1PluginId,{});else{var i=JSON.parse(t.body);if(i&&i.data&&i.data.data)try{ecEditor.dispatchEvent(n._constants.questionUnitId+":changeFontSize",function(t){i=t},i)}catch(t){console.log(t)}e={id:_.isUndefined(t.identifier)?UUID():t.identifier,type:t.type,pluginId:i.data.plugin.id,pluginVer:i.data.plugin.version,templateId:i.data.plugin.templateId,data:{__cdata:JSON.stringify(i.data.data)},config:{__cdata:JSON.stringify(i.data.config)}},ecEditor.instantiatePlugin(i.data.plugin.id,{}),ecEditor._.forEach(i.data.media,function(t){ecEditor._.isEmpty(t)||n.addMedia(t)})}e.w=80,e.h=85,e.x=9,e.y=6,s.w=80,s.h=85,s.x=9,s.y=6,s[n._questionPlugin].push(e)}),s},getConfig:function(){var t=this,e=t._super();return e.title=t.config.title,e.max_score=t.config.max_score,e.allow_skip=t.config.allow_skip,e.show_feedback=t.config.show_feedback,e.shuffle_questions=t.config.shuffle_questions,e.shuffle_options=t.config.shuffle_options,e.total_items=t.config.total_items,e},onConfigChange:function(t,e){var i=this;if(!_.isUndefined(e)){var n,s=this.data.length;switch(t){case"title":this.config.title=e,this.editorObj._objects[1]._objects[0].setText(e.toUpperCase());break;case"total_items":this.config.total_items=e,this.editorObj._objects[1]._objects[1].setText(e+"/"+s+"Questions,");break;case"max_score":this.config.max_score=e,this.editorObj._objects[1]._objects[2].setText(e+"Marks");break;case"shuffle_questions":(this.config.shuffle_questions=e)&&(n=this.config.shuffle_questions?this.data.length:this.config.max_score,this.editorObj._objects[1]._objects[2].setText(n+" Marks"),_.each(i.data,function(t,e){null!=t.body&&((t=JSON.parse(i.data[e].body)).data.config.metadata.max_score=1,t.data.config.max_score=1,i.data[e].body=JSON.stringify(t)),i.data[e].max_score=1}),this.config.max_score=i.data.length,ecEditor.dispatchEvent("org.ekstep.toaster:info",{title:"Each question will carry equal weightage of 1 mark when using Shuffle. To provide different weightage to individual questions please turn off Shuffle.",position:"topCenter"}));break;case"show_feedback":this.config.show_feedback=e;break;case"optionShuffle":this.config.optionShuffle=e;break;case"btn_edit":ecEditor.dispatchEvent("delete:invoke")}}ecEditor.render(),ecEditor.dispatchEvent("object:modified",{target:ecEditor.getEditorObject()})},openQuestionBank:function(t,e){var i=ecEditor._.isUndefined(e)?void 0:(e=e.callback,{data:ecEditor.getCurrentObject().data,config:ecEditor.getCurrentObject().config});ecEditor.dispatchEvent("org.ekstep.questionbank:showpopup",{callback:e,data:i})},getSummary:function(){var n={totalQuestions:0,totalScore:0,questions:[]},s=this.config.total_items;return this._questions.forEach(function(t,e){n.questions.push({identifier:t.identifier})}),this.config.shuffle_questions?(n.totalQuestions=s,n.totalScore=s):this._questions.forEach(function(t,e){var i;e<s&&(null!=t.body?(e=null==JSON.parse(t.body).data.config.questionCount?1:JSON.parse(t.body).data.config.questionCount,i=null==JSON.parse(t.body).data.config.max_score?1:JSON.parse(t.body).data.config.max_score,n.totalQuestions=n.totalQuestions+parseInt(e),n.totalScore=n.totalScore+parseInt(i)):(n.totalQuestions=n.totalQuestions+parseInt(1),n.totalScore=n.totalScore+t.max_score))}),n},loadQSPlugins:function(){var i,t,n=this,e=org.ekstep.pluginframework.pluginManager.getPluginManifest(n.manifest.id).ver.split(".")[0],e={request:{filters:{objectType:["Content"],contentType:["Plugin"],"targets.id":n.manifest.id,"targets.ver":{"<=":Number(e)},status:"Live"},limit:50,fields:["contentType","semanticVersion","appIcon"]}};_.isFunction(ecEditor.getService("search").pluginsSearch)?(t=ecEditor.getConfig("pluginsRepoUrl")?ecEditor.getConfig("pluginsRepoUrl"):void 0,ecEditor.getService("search").pluginsSearch(t,e,function(t,e){t||(i=e.data.result.content,n.pluginsRespHandler(i))})):ecEditor.getService("search").search(e,function(t,e){t||(i=e.data.result.content,n.pluginsRespHandler(i))})},pluginsRespHandler:function(t){this._plugins=t;var i=[];ecEditor._.forEach(t,function(t,e){t&&(t={id:t.identifier,ver:t.semanticVersion,type:"plugin"},i.push(t))}),org.ekstep.pluginframework.pluginManager.loadAllPlugins(_.isArray(i)?i:[i],[])},getplugins:function(t,e){e(this._plugins)},_checkForMathText:function(t,e){return void 0!==e&&(e=JSON.stringify(e),ecEditor._.isEmpty(e.match(/data-math/g))&&ecEditor._.isEmpty(e.match(/math-text/g))||_.isEmpty(t.theme["plugin-manifest"].plugin.filter(t=>"org.ekstep.mathfunction"==t.id))&&t.theme["plugin-manifest"].plugin.push(this.katexTemplate.pluginManifest)),t}}))